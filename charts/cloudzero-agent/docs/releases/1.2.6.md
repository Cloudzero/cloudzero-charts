## [1.2.6](https://github.com/Cloudzero/cloudzero-agent/compare/v1.2.5...v1.2.6) (2025-08-05)

Release 1.2.6 introduces a new CronJob-based backfill system, comprehensive resource management improvements, and enhanced security and reliability features.

### Key Features

- **Enhanced Shutdown Coordination**: Implemented robust file-based shutdown coordination between collector and shipper containers with intelligent waiting mechanisms and timeout protection, ensuring graceful shutdown sequences.
- **Dual Backfill System**: Implemented both a CronJob for scheduled runs (default: every 12 hours) and an immediate Job for instant execution on install, providing both immediate execution and configurable recurring runs for ongoing data collection.
- **Comprehensive Resource Management**: Systematic refactoring of all components with centralized resource generation, providing consistent resource request/limit configurations across all containers.

### Security Enhancements

- **Checkov Security Integration**: Added comprehensive security analysis with Checkov to build system and CI, fixing multiple Kubernetes security violations including missing liveness and readiness probes.
- **Fail-Open Webhook Validation**: Implemented true fail-open behavior for webhook validation with always-allow behavior, ensuring webhook validation never blocks Kubernetes resource operations.
- **Enhanced Health Monitoring**: Added proper liveness and readiness probes to prometheus-config-reloader container, improving container health monitoring and automatic restart capabilities.
- **Comprehensive Security Context Implementation**: Added configurable security context support to all Kubernetes pods and containers.

### Additional Enhancements

- **Observability Improvements**: Removed observability files on upload to prevent storage bloat and improve performance.
- **Scout Configuration Enhancement**: Updated scout to return Google project number instead of project ID for improved metadata accuracy.
- **Cloud Account Validation**: Added JSON Schema validation for cloudAccountId contents to ensure proper configuration.
- **Image Pull Secrets**: Added image pull secrets support for config loader and helmless jobs for enhanced security.

### Technical Improvements

- **Centralized Resource Generation**: Created reusable helper functions for consistent resource configuration patterns across all templates.
- **Backward Compatibility**: Maintained full backward compatibility through legacy precedence logic, ensuring existing deployments continue to work without changes.
- **Comprehensive Testing**: Added 20 test suites with 87 total tests covering all fallback scenarios, security context functionality, and edge cases.

### Resource Configuration Details

**New Component Structure:**

- **Core Components**: `components.agent.resources`, `components.aggregator.collector.resources`, `components.aggregator.shipper.resources`, `components.webhookServer.resources`
- **Job Components**: `components.miscellaneous.configLoader.resources`, `components.webhookServer.backfill.resources`, `components.agent.federatedNode.resources`
- **New Components**: `components.helmless.resources`, `components.initCertJob.resources`
- **Specialized Components**: `components.agent.configmapReloader.resources`, `components.validator.resources`, `components.kubeStateMetrics.resources`

### Upgrade Steps

To upgrade to version 1.2.6, run the following command:

```sh
helm upgrade --install <RELEASE_NAME> cloudzero/cloudzero-agent -n <NAMESPACE> --create-namespace -f configuration.example.yaml --version 1.2.6
```
