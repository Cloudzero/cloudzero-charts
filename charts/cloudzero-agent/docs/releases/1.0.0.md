## [Release 1.0.0](https://github.com/Cloudzero/cloudzero-agent/compare/v0.0.28...v1.0.0) (2024-12-23)

This release adds native Kubernetes Labels, and Annotation support to the CloudZero platform. You are now able to identify Kubernetes dementions based on the Labels and Annotations you use in your Kubernetes deployments.

To take advantage of these new features, the following configuration changes are made to the chart:


An example `example-override-values.yaml` file:
```yaml
# -- UNCHANGED: Cloud Service Provider Account ID
#    This must be a string - even if it is a number in your system.
#    Adding a new line here is an easy work around
cloudAccountId: |-
  null
# -- UNCHANGED: The Cluster name
clusterName: null
# -- UNCHANGED: The Cloud Service Provider Region
region: null
# -- UNCHANGED: CloudZero API key. Required if existingSecretName is null.
apiKey: null
# -- UNCHANGED: If set, the agent will use the API key in this Secret to authenticate with CloudZero.
existingSecretName: null

# -- NEW: Flag to deploy the jetstack.io "cert-manager". Most environments will already have this deployed, in which case you will want to set this to "false". 
# If not, enabling this to true is a quick way to get started. See the README for more information.
cert-manager:
  # -- DEFAULT: enabled.
  enabled: true | false

# -- NEW: Service Account used for the insights controller
# The account is required. If you already have an existing account set the name in the field below.
serviceAccount:
  # -- DEFAULT: enabled.
  create: true | false
  name: ""
  annotations: {}

# -- NEW: label and annotation configuration:
insightsController:
  # -- By default, a ValidatingAdmissionWebhook will be deployed that records all created labels and annotations
  enabled: true | false
  labels:
    # -- DEFAULT: enabled.
    enabled: true | false
    # -- This value MUST be set to a list of regular expressions which will be used to gather labels from pods, deployments, statefulsets, daemonsets, cronjobs, jobs, nodes, and namespaces
    patterns:
      # List of golang style regular expressions used to filter desired labels
      # Caution, the CloudZero system has a limit of 300 labels and annotations
      # thus is it wise to provide a list of the labels you need explicitly
      - '.*'
  annotations:
    # -- DEFAULT: disabled.
    enabled: true | false
    patterns:
      # List of golang style regular expressions used to filter desired labels
      # Caution, the CloudZero system has a limit of 300 labels and annotations
      # thus is it wise to provide a list of the labels you need explicitly
      - '.*'
```

* Upgrade Instructions:

If you currently have an existing CloudZero Agent deployment, you will want to:

1. Ensure the `value.yaml` override configuration is defined (outlined above). Note that other values may no longer be necessary.

2. Update the Helm chart repository:
  ```sh
  helm repo add cloudzero https://cloudzero.github.io/cloudzero-charts
  helm repo update
  ```

3. Upgrade the deployment

  ```sh
  helm upgrade --install <YOUR_RELEASE_NAME> -n <YOUR_NAMESPACE> cloudzero -f override-values.yaml
  ```
  > Replace `<YOUR_RELEASE_NAME>` with the name you used to release the chart into your environment
  >
  > Replace `<YOUR_NAMESPACE>` with the namespace you used for your deployment.

## Deprecations and Breaking Changes

1. `node-exporter` has been deprecated and is no longer used
2. `kube-state-metrics`  no longer requires the `--metric-allowlist` configuration flag for CloudZero. Previously, pod labels were exported using the `kube-state-metrics.extraArgs` field. Pod labels must now be configured using the `tags.labels` section. See the [Labels and Annotaitons](https://github.com/Cloudzero/cloudzero-charts/tree/develop/charts/cloudzero-agent#labels-and-annotations) section for details.
3. API key management arguments have moved to the `global` section. Previous, an `apiKey` or `existingSecretName` argument could be passed to the chart. This is no longer allowed; those arguments should instead be passed as `global.apiKey` and `global.existingSecretName`, respectively.

### Security Scan Results

| Image                                                                         | Scanner | Scan Date | Critical | High | Medium | Low | Negligible |
|:---------------------------------------------------------------------------------------|:-----:|:----------:|---|---|---|---|---|
| ghcr.io/cloudzero/cloudzero-insights-controller/cloudzero-insights-controller:0.1.0     | Grype | 2024-12-23 | 0 | 0 | 0 | 0 | 0 |
| ghcr.io/cloudzero/cloudzero-agent-validator/cloudzero-agent-validator:0.10.0             | Grype | 2024-12-23 | 0 | 0 | 0 | 0 | 0 |
